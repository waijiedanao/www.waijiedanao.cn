webpackJsonp([5],{"Aic+":function(e,t,n){e.exports=n.p+"static/img/login-bg.7584f6a.png"},W2Q3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("lC5x"),o=n.n(r),a=n("J0Oq"),i=n.n(a),s=n("f744"),c=n("rVsN"),m=n.n(c),u=n("4YfN"),l=n.n(u),d=n("2bvH"),p={data:function(){return{formType:1,title:["登录","注册","忘记密码"],smsTimer:"",smsTimes:60,loginDiloagShow:!1,wechatQrcodeImg:"",loginTime:"",ruleForm:{account:"",nickName:"",email:"",password:"",smsCode:""},rules:{account:[{required:!0,message:"请输入账号",trigger:"blur"}],smsCode:[{required:!0,message:"请输入验证码",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:30,message:"长度在 4 到 30 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"长度在 8 到 16 个字符",trigger:"blur"}]}}},computed:l()({},Object(d.c)(["userInfo"])),components:{},created:function(){},methods:l()({},Object(d.b)(["setUserInfo"]),{loginRequest:function(e,t){var n,r=this;return new m.a((n=i()(o.a.mark(function n(a,i){var s,c;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.$http.post(r.serverPath.login,e,t);case 2:s=n.sent,localStorage.setItem("token",s.data.access_token),r.setUserInfo(s.data.user),r.$base.toast("登录成功","success"),(c=r.$route.query.redirect)?r.$router.push(c):r.$router.push("/"),a();case 9:case"end":return n.stop()}},n,r)})),function(e,t){return n.apply(this,arguments)}))},registRequest:function(e,t){var n,r=this;return new m.a((n=i()(o.a.mark(function n(a,i){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.$http.post(r.serverPath.register,e,t);case 2:n.sent,r.$base.toast("注册成功","success"),r.formType=1,a();case 6:case"end":return n.stop()}},n,r)})),function(e,t){return n.apply(this,arguments)}))},resetPwdRequest:function(e,t){var n,r=this;return new m.a((n=i()(o.a.mark(function n(a,i){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.$http.put(r.serverPath.register,e,t);case 2:n.sent,r.$base.toast("重置成功","success"),r.formType=1;case 5:case"end":return n.stop()}},n,r)})),function(e,t){return n.apply(this,arguments)}))},smsCodeRequest:function(e,t){var n,r=this;return new m.a((n=i()(o.a.mark(function t(n,a){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.$http.post(r.serverPath.smsCode,e);case 2:t.sent,r.smsTimes--,r.smsTimer=setInterval(function(){r.smsTimes--,0==r.smsTimes&&(clearInterval(r.smsTimer),r.smsTimes=60)},1e3),n();case 6:case"end":return t.stop()}},t,r)})),function(e,t){return n.apply(this,arguments)}))},getWechatLoginImg:function(){var e=this;return i()(o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return clearInterval(e.loginTime),e.loginDiloagShow=!0,t.next=4,e.$http.post(e.serverPath.wechatLoginImg,{});case 4:n=t.sent,e.wechatQrcodeImg=n.data.qrcode,e.loginTime=setInterval(function(){e.checkWechatLoginState(n.data.code)},2e3);case 7:case"end":return t.stop()}},t,e)}))()},checkWechatLoginState:function(e){var t=this;return i()(o.a.mark(function n(){var r,a;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$http.post(t.serverPath.checkWechatLoginState,{code:e});case 2:(r=n.sent).data.success&&(clearInterval(t.loginTime),localStorage.setItem("token",r.data.access_token),r.data.user.portrait=r.data.user.wxuser.headimgurl,t.setUserInfo(r.data.user),t.$base.toast("登录成功","success"),(a=t.$route.query.redirect)?t.$router.push(a):t.$router.push("/"));case 4:case"end":return n.stop()}},n,t)}))()}}),mounted:function(){}},g=n("fRcE"),f={data:function(){return{btnLoading:!1}},mixins:[s.a,p],watch:{formType:function(){this.ruleForm={account:"",nickName:"",email:"",password:"",smsCode:""}}},methods:{wechatLogin:function(){this.$base.isWechatBrowser()?location.href="https://www.waijiedanao.com/api/users/wx_login":this.getWechatLoginImg()},validateInput:function(e){var t=this;try{e.forEach(function(e){if(""==t.ruleForm[e].trim())throw t.$base.toast(t.rules[e][0].message),new Error("");if("email"==e&&!t.$base.emailReg(t.ruleForm.email))throw t.$base.toast("邮箱输入有误"),new Error("");if("account"==e&&!/^.{4,30}$/.test(t.ruleForm.account))throw t.$base.toast("用户名长度在4到30个字符"),new Error("");if("password"==e&&!/^.{4,16}$/.test(t.ruleForm.password))throw t.$base.toast("密码长度在8到16个字符"),new Error("")});return!0}catch(e){}},getSms:function(){var e=this;return i()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(60==e.smsTimes){t.next=2;break}return t.abrupt("return");case 2:if(1==e.formType){t.next=9;break}if(e.ruleForm.email.trim()){t.next=6;break}return e.$base.toast("请输入邮箱","warning"),t.abrupt("return");case 6:if(e.$base.emailReg(e.ruleForm.email)){t.next=9;break}return e.$base.toast("邮箱输入有误","warning"),t.abrupt("return");case 9:return t.next=11,e.smsCodeRequest({email:e.ruleForm.email,mode:2==e.formType?1:2});case 11:case"end":return t.stop()}},t,e)}))()},login:function(){var e=this;return i()(o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=["account","password"],e.validateInput(n)){t.next=3;break}return t.abrupt("return",!1);case 3:return t.prev=3,e.$base.showLoading(),t.next=7,e.loginRequest({name:e.ruleForm.account,password:e.ruleForm.password},function(){e.$base.hideLoading()});case 7:e.$base.hideLoading(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),e.$base.hideLoading();case 13:case"end":return t.stop()}},t,e,[[3,10]])}))()},resetPwd:function(){var e=this;return i()(o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=["email","password","smsCode"],e.validateInput(n)){t.next=3;break}return t.abrupt("return",!1);case 3:return t.prev=3,e.$base.showLoading(),t.next=7,e.resetPwdRequest({password:e.ruleForm.password,email:e.ruleForm.email,verifyCode:e.ruleForm.smsCode},function(){e.$base.hideLoading()});case 7:e.$base.hideLoading(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),e.$base.hideLoading();case 13:case"end":return t.stop()}},t,e,[[3,10]])}))()},register:function(){var e=this;return i()(o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=["account","password","email","smsCode"],e.validateInput(n)){t.next=3;break}return t.abrupt("return",!1);case 3:return t.prev=3,e.$base.showLoading(),t.next=7,e.registRequest({name:e.ruleForm.nickName,password:e.ruleForm.password,email:e.ruleForm.email,verifyCode:e.ruleForm.smsCode},function(){e.$base.hideLoading()});case 7:e.$base.hideLoading(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),e.$base.hideLoading();case 13:case"end":return t.stop()}},t,e,[[3,10]])}))()},formSubmit:function(){1==this.formType?this.login():2==this.formType?this.register():3==this.formType&&this.resetPwd()}},beforeRouteLeave:function(e,t,n){clearInterval(this.loginTime),n()},components:{XDialog:g.a}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login—container"},[n("div",{staticClass:"logo",on:{click:function(t){return e.$router.push("/")}}},[e._v("外接大脑")]),e._v(" "),n("div",{staticClass:"main-content"},[n("div",{staticClass:"form-container"},[n("form",{ref:"ruleForm",staticClass:"login-container",on:{submit:function(e){return e.preventDefault(),!1}}},[n("h3",{staticClass:"title"},[e._v(e._s(e.title[e.formType-1]))]),e._v(" "),1==e.formType?n("div",{staticClass:"form-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.account,expression:"ruleForm.account"}],attrs:{type:"text","auto-complete":"off",clearable:"",placeholder:"请输入邮箱/用户名"},domProps:{value:e.ruleForm.account},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"account",t.target.value)}}})]):e._e(),e._v(" "),2==e.formType?n("div",{staticClass:"form-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.nickName,expression:"ruleForm.nickName"}],attrs:{type:"text","auto-complete":"off",clearable:"",placeholder:"请输入用户名"},domProps:{value:e.ruleForm.nickName},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"nickName",t.target.value)}}})]):e._e(),e._v(" "),1!=e.formType?n("div",{staticClass:"form-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.email,expression:"ruleForm.email"}],attrs:{type:"text","auto-complete":"off",clearable:"",placeholder:"请输入邮箱"},domProps:{value:e.ruleForm.email},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"email",t.target.value)}}})]):e._e(),e._v(" "),n("div",{staticClass:"form-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.password,expression:"ruleForm.password"}],attrs:{type:"password","auto-complete":"off",clearable:"",placeholder:"请输入密码"},domProps:{value:e.ruleForm.password},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"password",t.target.value)}}})]),e._v(" "),1!=e.formType?n("div",{staticClass:"form-item sms-code—container"},[n("span",{staticClass:"btn send-code-btn",on:{click:e.getSms}},[e._v(e._s(60==e.smsTimes?"发送验证码":e.smsTimes+"s"))]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.smsCode,expression:"ruleForm.smsCode"}],attrs:{type:"text",maxlength:"6","auto-complete":"off",placeholder:"请输入验证码"},domProps:{value:e.ruleForm.smsCode},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"smsCode",t.target.value)}}})]):e._e(),e._v(" "),n("div",{staticClass:"form-item"},[n("button",{staticClass:"btn btn-main",on:{click:e.formSubmit}},[e._v(e._s(1==e.formType?"登录":2==e.formType?"注册":"重置密码"))])]),e._v(" "),n("div",{staticClass:"form-item other-btn"},[n("span",{staticClass:"wechat-login",on:{click:e.wechatLogin}},[e._v("微信登录")]),e._v(" "),1!=e.formType?n("span",{on:{click:function(t){e.formType=1}}},[e._v("登录")]):e._e(),e._v(" "),2!=e.formType?n("span",{on:{click:function(t){e.formType=2}}},[e._v("注册")]):e._e(),e._v(" "),3!=e.formType?n("span",{on:{click:function(t){e.formType=3}}},[e._v("忘记密码")]):e._e()])]),e._v(" "),e._m(0)])]),e._v(" "),n("x-dialog",{staticClass:"login-dialog",attrs:{"hide-on-blur":""},model:{value:e.loginDiloagShow,callback:function(t){e.loginDiloagShow=t},expression:"loginDiloagShow"}},[n("div",{staticClass:"dialog-title"},[e._v("微信登录")]),e._v(" "),n("img",{staticClass:"qrcode-img",attrs:{src:e.wechatQrcodeImg,alt:""}}),e._v(" "),n("div",{on:{click:function(t){e.loginDiloagShow=!1}}},[n("span",{staticClass:"vux-close"})])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"hint-text"},[this._v("\n        登录/注册即表示你同意\n        "),t("a",[this._v("用户协议")]),this._v(" 和\n        "),t("a",[this._v("隐私条款")])])}]};var v=n("C7Lr")(f,h,!1,function(e){n("yRf8")},null,null);t.default=v.exports},tYpf:function(e,t,n){var r=n("L4zZ");(e.exports=n("UTlt")(!1)).push([e.i,"\n.login—container {\n  min-height: 100vh;\n  background: url("+r(n("Aic+"))+") no-repeat center;\n  background-size: cover;\n}\n.login—container .logo {\n  color: #ed4040;\n  position: absolute;\n  left: 0rem;\n  top: 0.1rem;\n  font-weight: bold;\n  font-size: 0.5rem;\n  padding: 0.3rem;\n  cursor: default;\n}\n.login—container .main-content {\n  width: 90%;\n  margin: 0 auto;\n  padding: 1rem 0 0;\n}\n.login—container .main-content .form-container .login-container {\n  margin-top: 2rem;\n  padding: 0 0.5rem;\n  border-radius: 5px;\n  background: #fff;\n  border: 1px solid #eaeaea;\n  -webkit-box-shadow: 0 0 0.5rem #ddd;\n          box-shadow: 0 0 0.5rem #ddd;\n}\n.login—container .main-content .form-container .login-container .form-item {\n  margin-bottom: 0.4rem;\n}\n.login—container .main-content .form-container .login-container .title {\n  line-height: 1rem;\n  padding-top: 0.2rem;\n  border-bottom: 1px solid #eaeaea;\n  margin-bottom: 0.4rem;\n  text-align: center;\n  font-weight: normal;\n}\n.login—container .main-content .form-container .login-container input {\n  line-height: 0.4rem;\n  height: 0.8rem;\n  color: #333;\n  font-size: 0.28rem;\n  border: 1px solid #DCDFE6;\n  border-radius: 4px;\n  padding: 0.2rem 0.3rem;\n  display: block;\n  width: 100%;\n  outline: none;\n}\n.login—container .main-content .form-container .login-container .sms-code—container {\n  position: relative;\n}\n.login—container .main-content .form-container .login-container .sms-code—container .send-code-btn {\n  position: absolute;\n  padding: 0 0.4rem;\n  right: 0;\n  top: 0.1rem;\n  line-height: 0.6rem;\n  z-index: 1;\n  text-align: center;\n  border-left: 1px solid #ddd;\n  cursor: default;\n}\n.login—container .main-content .form-container .login-container .other-btn {\n  color: #406599;\n  cursor: default;\n  text-align: right;\n}\n.login—container .main-content .form-container .login-container .other-btn .wechat-login {\n  float: left;\n  margin-left: 0;\n}\n.login—container .main-content .form-container .login-container .other-btn span {\n  margin-left: 0.4rem;\n}\n.login—container .main-content .form-container .hint-text {\n  margin-top: 0.6rem;\n  font-size: 0.24rem;\n  text-align: center;\n}\n.login—container .main-content .form-container .hint-text a {\n  color: #406599;\n}\n.login-dialog {\n  text-align: center;\n}\n.login-dialog .dialog-title {\n  font-weight: bold;\n  font-size: 0.3rem;\n  padding: 0.4rem 0.8rem;\n}\n.login-dialog .qrcode-img {\n  display: block;\n  width: 4rem;\n  height: 4rem;\n  margin: 0 auto 0.4rem;\n}\n.login-dialog .vux-close {\n  padding-bottom: 1rem;\n}\n",""])},yRf8:function(e,t,n){var r=n("tYpf");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);n("FIqI")("4ea380eb",r,!0,{})}});